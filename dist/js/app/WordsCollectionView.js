define(function(a){"use strict";var b=a("backbone"),c=a("app/WordModelView"),d=a("app/NewEntryFormView"),e=a("i18n!../../js/nls/locales"),f=a("helpers/getComputedStyle").getStyle,g=a("app/UserModel"),h=a("text!../../templates/wordsCollectionViewHeader.html"),i=a("text!../../templates/liTemplate.html"),j=a("text!../../templates/tableTemplate.html"),k=a("app/WordsCollection"),l=a("app/AppHeaderView"),m=b.View.extend({el:$(".content-box"),initialize:function(){this.user=new g,this.childViews=[]},events:{"click .groups-li":"selectGroup","click .td-filter":"filterTable","click .reset-filed":"resetFiledItems","click .reset-all":"resetAllItems"},render:function(){var a=this;return this.childViews.length&&this.onClose(),this.user.fetch({success:function(b,c,d){a.collection=new k(b.get("words").models),a.collection.on("add",a.handleSuccess,a)},error:function(b,c,d){a.handleError()}}).done(function(){a.handleSuccess()}),this},handleSuccess:function(){var a=_.template(h,e);this.$el.html(a),this.showNewEntryForm(),this.createGroupList(),this.createTable(),this.setOpacity(this.opacityIndex),this.appendHeader()},handleError:function(){alert(e.msg.systemErrorMessage),console.log(e.msg.systemErrorMessage),this.goTo("/list"),window.location.reload()},showNewEntryForm:function(){var a=new d;a.collection=this.collection,this.$el.append(a.render().el),this.childViews.push(a)},createGroupList:function(){var a=_.template(i),b=_.uniq(_.pluck(_.sortBy(this.collection.toJSON(),"wordGroup"),"wordGroup"));_.each(b,function(b){$(".groups-ul").append(a({li:b.trim()}))})},createTable:function(){var a=_.template(j);this.$el.append(a(e)),this.collection.each(function(a){a.set("i18n",e);var b=new c({model:a});this.childViews.push(b),$(".collection-table").append(b.render().el)},this),this.setHeadWidth()},setHeadWidth:function(){var a=document.querySelectorAll(".collection-table tr:first-child td"),b=document.querySelectorAll(".td-filter");_.each(b,function(b,c){var d=2*parseInt(f(b).paddingRight)||0,e=parseInt(f(b).borderRight)||1,g=a[c].offsetWidth-d-e+"px";$(b).css({width:g})})},selectGroup:function(a){a=a||window.event;var b=a.target||a.srcElement;$(".new-entry-input").val($(b).text())},filterTable:function(a){a=a||window.event;var b,c;switch(b=a.target||a.srcElement,b=$(b).closest("td"),c=$(b)[0].cellIndex){case 0:this.collection.comparator=function(a){return a.get("enWord")},this.collection.sort();break;case 1:this.collection.comparator=function(a){return a.get("ruWord")},this.collection.sort();break;case 2:this.collection.comparator=function(a){return a.get("wordGroup")},this.collection.sort();break;default:this.collection.comparator=function(a){return a.get("enWord")}}this.opacityIndex=c,$(".fixed-head, .collection-table-container").remove(),this.createTable(),this.setOpacity(this.opacityIndex)},opacityIndex:0,setOpacity:function(a){var b=this.$el.find(".filter-arrow");_.each(b,function(a){$(a).css({opacity:1})&&$(a).css({opacity:.2})}),$(b[a]).css({opacity:1})},resetFiledItems:function(){var a=this,b=confirm(e.conf.baseReloadFirstWarning.join(" "));if(b){var c=confirm(e.conf.baseReloadSecondWarning.join(" "));c&&$.when(a.goTo("/resetFiled")).then(function(){window.location.reload()})}},resetAllItems:function(){var a=this,b=confirm(e.conf.fullReloadFirstWarning.join(" "));if(b){var c=confirm(e.conf.fullReloadSecondWarning.join(" "));c&&$.when(a.goTo("/resetAll")).then(function(){window.location.reload()})}},appendHeader:function(){var a=new l;this.$el.prepend(a.render().el),this.childViews.push(a)},onClose:function(){var a=this.childViews;_.each(a,function(a){a.close()})}});return m});