define(function(a){"use strict";a("helpers/some");var b=a("backbone"),c=a("underscore.string"),d=a("i18n!../../js/nls/ru"),e=a("text!../../templates/wordItem.html"),f=a("text!../../templates/wordItemHeader.html"),g=b.View.extend({tagName:"tr",className:"table-item",initialize:function(){this.model.on("destroy",this.remove,this),this.model.on("change",this.render,this)},events:{"click .delete":"deleteModel","click .edit":"editModel","click .saveEdits":"saveEdits"},template:_.template(e),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},deleteModel:function(){var a=this,b=confirm(d.conf.confirmModelDelete);return b&&("tr-header"==this.$el.prev().attr("class")&&this.$el.prev().remove(),this.model.destroy({data:{id:a.model.get("_id")},success:function(a,b,c){},error:function(a,b,c){console.log(error)}})),!1},editModel:function(){var a=this.$el.prev().attr("class");if("tr-header"!=a){this.$el.find("span").attr("contenteditable",!0).css("background-color","#faffaf"),this.$el.find("span").first().focus(),this.$el.find("td.enSynonyms, td.ruSynonyms").css({display:"table-cell"});var b=_.template(f);this.$el.before(b(d))}},saveEdits:function(){var a={},b=this.$el.find("span").some(function(a){return c.isBlank($(a).text())});if(b)return alert(d.alert.fillAllInputs),"tr-header"==this.$el.prev().attr("class")&&this.$el.prev().remove(),this.render(),this.$el.find(".edit").click(),void(a=null);this.validateEdits();var e=this.$el.find("span");_.each(e,function(b){a[$(b).attr("class")]=c.clean($(b).text())}),this.$el.find("span").attr("contenteditable",!1).css("background-color",""),this.$el.find("td.enSynonyms, td.ruSynonyms").css("display","none"),"tr-header"==this.$el.prev().attr("class")&&this.$el.prev().remove(),this.model.save(a)},validateEdits:function(){var a=c.clean(this.$el.find(".enWord span").text()),b=c.clean(this.$el.find(".ruWord span").text()),d=this.$el.find(".enSynonyms span"),e=this.$el.find(".ruSynonyms span");$(d).text(this.addSynonym(a,d)),$(e).text(this.addSynonym(b,e))},addSynonym:function(a,b){var d=b.text().split(","),e=d.some(function(b){return c.clean(b)==a});return e?void 0:a+", "+b.text()}});return g});