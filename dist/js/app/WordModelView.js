define(["backbone","underscore.string","i18n!../../js/nls/ru","text!../../templates/wordItem.html","text!../../templates/wordItemHeader.html","helpers/some"],function(a,b,c,d,e){"use strict";var f=a.View.extend({tagName:"tr",className:"table-item",initialize:function(){this.model.on("destroy",this.remove,this),this.model.on("change",this.render,this)},events:{"click .delete":"deleteModel","click .edit":"editModel","click .saveEdits":"saveEdits"},template:_.template(d),render:function(){return this.$el.html(this.template(this.model.toJSON())),this},deleteModel:function(){var a=this,b=confirm(c.conf.confirmModelDelete);return b&&("tr-header"==this.$el.prev().attr("class")&&this.$el.prev().remove(),this.model.destroy({data:{id:a.model.get("_id")},success:function(a,b,c){},error:function(a,b,c){console.log(error)}})),!1},editModel:function(){var a=this.$el.prev().attr("class");if("tr-header"!=a){this.$el.find("td.enWord, td.ruWord, td.enSynonyms, td.ruSynonyms, td.wordGroup").attr("contenteditable",!0).css("background-color","#faffaf"),this.$el.find("td").first().focus(),this.$el.find(".enSynonyms, .ruSynonyms").css("display","");var b=_.template(e);this.$el.before(b(c))}},saveEdits:function(){var a={},d=this.$el.find("td").some(function(a){return b.isBlank($(a).text())});if(d)return alert(c.alert.fillAllInputs),"tr-header"==this.$el.prev().attr("class")&&this.$el.prev().remove(),this.render(),this.$el.find(".edit").click(),void(a=null);this.validateEdits();var e=this.$el.find("td.enWord, td.ruWord, td.enSynonyms, td.ruSynonyms, td.wordGroup");_.each(e,function(c){a[$(c).attr("class")]=b.clean($(c).text())}),this.$el.find("td.enWord, td.ruWord, td.enSynonyms, td.ruSynonyms, td.wordGroup").attr("contenteditable",!1).css("background-color",""),this.$el.find(".enSynonyms, .ruSynonyms").css("display","none"),"tr-header"==this.$el.prev().attr("class")&&this.$el.prev().remove(),this.model.save(a)},validateEdits:function(){var a=b.clean(this.$el.find("td.enWord").text()),c=b.clean(this.$el.find("td.ruWord").text()),d=this.$el.find("td.enSynonyms"),e=this.$el.find("td.ruSynonyms");$(d).text(this.addSynonym(a,d)),$(e).text(this.addSynonym(c,e))},addSynonym:function(a,c){var d=c.text().split(","),e=d.some(function(c){return b.clean(c)==a});return e?void 0:a+", "+c.text()}});return f});