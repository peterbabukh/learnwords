define(function(a){"use strict";a("helpers/formToJSON"),a("helpers/some");var b=a("backbone"),c=a("app/WordModel"),d=a("underscore.string"),e=a("i18n!../../js/nls/ru"),f=a("text!../../templates/newEntry.html"),g=b.View.extend({events:{"blur .enWord":"transferEnData","blur .ruWord":"transferRuData","click .submit-entry":"addNewEntry"},template:_.template(f),render:function(){return this.$el.append(this.template(e)),this},addNewEntry:function(a){a=a||window.event,a.preventDefault();var b=a.target||a.srcElement,d=$(b).closest("form");if(!this.validateForm(d))return void alert(e.alert.fillAllInputs);var f=d.serializeObject();if(_.each(_.keys(f),function(a){f[a]=_.escape(f[a])}),!this.validateObject(f))return void alert(e.alert.suchModelExists);$(".res").empty(),d.find('input[type="text"]').not('[name="wordGroup"]').val("");var g=new c(f);this.collection.push(g),g.save({creator:"user"})},validateObject:function(a){var b=!0;return this.collection.each(function(c){(d.clean(a.enWord.toLowerCase())==d.clean(c.get("enWord").toLowerCase())||d.clean(a.ruWord.toLowerCase())==d.clean(c.get("ruWord").toLowerCase()))&&(b=!1)}),b===!0},validateForm:function(a){var b=$(a).find('input[type*="text"]').some(function(a){return d.isBlank($(a).val())});return b?!1:!0},transferEnData:function(){this.transferData(".enWord",'input[name="enSynonyms"]')},transferRuData:function(){this.transferData(".ruWord",'input[name="ruSynonyms"]')},transferData:function(a,b){var c=this.$el.find(a).val(),e=this.$el.find(b).val();if(!d.isBlank(c))if(d.isBlank(e))this.$el.find(b).val(c+", ");else{if(-1!=e.indexOf(c+","))return;this.$el.find(b).val(c+", "+e)}}});return g});